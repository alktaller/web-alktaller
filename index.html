<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>AlkTaller</title>
  <link rel="icon" href="images/icono.png">
  <link rel="stylesheet" href="css/style.css?v=2">
  <style>
    /* Critical Internal CSS to prevent FOUC / Cache issues */
    .tab-content { display: none; }
    .tab-content.active { display: block; animation: fadeIn 0.3s; }
    @keyframes fadeIn { from{opacity:0} to{opacity:1} }
    .tab-menu { display: flex; gap: 10px; padding: 10px 0; border-bottom: 2px solid #E2E8F0; margin-bottom: 20px; overflow-x: auto; }
    .tab-btn { background:none; border:none; padding:10px 20px; font-weight:600; cursor:pointer; color:#718096; }
    .tab-btn.active { color:#0056D2; border-bottom: 2px solid #0056D2; }
  </style>
</head>
<body>

<div id="login-screen" class="hidden">
  <div class="login-container">
    <img src="images/logo.png" alt="AlkTaller Logo" class="login-logo">
    <h2>Bienvenido a AlkTaller</h2>
    <p>Introduce tu Token de Acceso para desbloquear tus datos.</p>
    
    <div class="input-group">
      <input type="password" id="githubTokenInput" placeholder="ghp_...">
      <button onclick="handleLogin()" class="btn-primary">Entrar</button>
    </div>
  </div>
</div>

<div id="app-container" class="hidden">
  <header>
    <div class="logo-area">
      <img src="images/logo.png" alt="AlkTaller" class="app-logo">
      <h1>AlkTaller</h1>
    </div>
    <div class="user-area">
      <button onclick="logout()" class="btn-secondary">ğŸšª Salir</button>
    </div>
  </header>

  <main>
    <div class="dashboard-controls">
      <select id="vehicleSelect"></select>
      <div class="action-buttons">
        <button onclick="addVehicle()" class="btn-primary">â• AÃ±adir coche</button>
        <button onclick="saveData(data)" class="btn-success">ğŸ’¾ Guardar cambios</button>
      </div>
    </div>

    <!-- Navigation Menu -->
    <nav class="tab-menu">
      <button class="tab-btn active" onclick="openTab('dashboard')">ğŸ“Š Resumen</button>
      <button class="tab-btn" onclick="openTab('actions')">ğŸ“ Operaciones</button>
      <button class="tab-btn" onclick="openTab('reminders')">â° Recordatorios</button>
      <button class="tab-btn" onclick="openTab('history')">ğŸ“‹ Historial</button>
    </nav>

    <!-- Tab 1: Dashboard (Stats + Vehicle Info) -->
    <div id="dashboard" class="tab-content active">
        <section class="card">
          <h2>ğŸ“Š EstadÃ­sticas</h2>
          <div id="stats"></div>
        </section>

        <section class="card">
          <h2>ğŸš— InformaciÃ³n del VehÃ­culo</h2>
          <div class="form-group" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
            <div>
              <label>MatrÃ­cula</label>
              <input id="infoPlate" type="text" placeholder="0000 XXX" onchange="updateVehicleInfo('plate', this.value)">
            </div>
            <div>
              <label>VIN (Bastidor)</label>
              <input id="infoVin" type="text" placeholder="VIN..." onchange="updateVehicleInfo('vin', this.value)">
            </div>
            <div>
              <label>Fecha MatriculaciÃ³n</label>
              <input id="infoRegDate" type="date" onchange="updateVehicleInfo('regDate', this.value)">
            </div>
            <div>
              <label>Fecha Compra</label>
              <input id="infoPurchaseDate" type="date" onchange="updateVehicleInfo('purchaseDate', this.value)">
            </div>
            <div>
              <label>Kilometraje Actual</label>
              <div style="display: flex; gap: 5px;">
                <input id="infoOdo" type="number" placeholder="km" onchange="updateVehicleOdometer(this.value)">
                <button onclick="updateVehicleOdometer(document.getElementById('infoOdo').value)" class="btn-secondary" title="Actualizar">ğŸ’¾</button>
              </div>
            </div>
          </div>
          <div class="form-group mt-2">
             <label>Notas</label>
             <textarea id="infoNotes" style="width:100%; padding:0.5rem; border:1px solid var(--border-color); border-radius:4px;" rows="2" placeholder="Notas adicionales..." onchange="updateVehicleInfo('notes', this.value)"></textarea>
          </div>
        </section>
    </div>

    <!-- Tab 2: Actions (Fuel + Maintenance) -->
    <div id="actions" class="tab-content">
        <div class="forms-grid">
            <section class="card">
              <h2>â›½ Nuevo repostaje</h2>
              <div class="form-group">
                <input id="fuelDate" type="date">
                <input id="fuelOdo" type="number" placeholder="KilÃ³metros">
                <input id="fuelLiters" type="number" placeholder="Litros">
                <input id="fuelCost" type="number" placeholder="Coste total (â‚¬)">
                <button onclick="addFuel()" class="btn-primary">Guardar repostaje</button>
              </div>
            </section>

            <section class="card">
              <h2>ğŸ”§ Nuevo mantenimiento</h2>
              <div class="form-group">
                <input id="maintDate" type="date">
                <input id="maintType" placeholder="Tipo (aceite, frenos...)" list="maintenance-categories">
                <input id="maintOdo" type="number" placeholder="KilÃ³metros">
                <input id="maintCost" type="number" placeholder="Coste (â‚¬)">
                <button onclick="addMaintenance()" class="btn-primary">Guardar mantenimiento</button>
              </div>
            </section>
        </div>
    </div>

    <!-- Tab 3: Reminders -->
    <div id="reminders" class="tab-content">
        <section class="card">
          <h2>â° Recordatorios</h2>
          <div class="table-responsive">
            <table id="reminderTable">
              <thead>
                <tr>
                  <th>TÃ­tulo</th>
                  <th>Frecuencia (km)</th>
                  <th>Tiempo</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <button onclick="addReminder()" class="btn-secondary mt-2">â• AÃ±adir recordatorio</button>
        </section>
    </div>

    <!-- Tab 4: History -->
    <div id="history" class="tab-content">
        <section class="card">
          <h2>ğŸ“‹ Historial</h2>
          <ul id="timeline"></ul>
        </section>
    </div>
  </main>
</div>

<script src="js/storage.js?v=2"></script>
<script src="js/app.js?v=2"></script>

</body>
</html>
